<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NOVA ERP ì¡°íšŒë¥¼ ìœ„í•œ Gemini ì±—ë´‡</title>
    <!-- Tailwind CSS CDN ë¡œë“œ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        /* ì‚¬ìš©ì ì •ì˜ ìŠ¤íƒ€ì¼ */
        #messages {
            height: 70vh;
            overflow-y: auto;
            border-bottom: 1px solid #e5e7eb;
        }
        .user-message {
            @apply bg-blue-500 text-white p-3 rounded-lg shadow-md mb-2 max-w-3/4 self-end;
        }
        .ai-message {
            @apply bg-gray-100 text-gray-800 p-3 rounded-lg shadow-md mb-2 max-w-3/4 self-start;
        }
        #loading {
            @apply text-sm text-gray-500 italic mb-2;
        }
    </style>
</head>
<body class="bg-gray-50 font-sans flex items-center justify-center min-h-screen p-4">

<div id="chat-container" class="w-full max-w-3xl bg-white rounded-xl shadow-2xl flex flex-col h-[90vh]">
    <header class="p-4 border-b bg-indigo-600 text-white rounded-t-xl">
        <h1 class="text-xl font-bold">Gemini ì±—ë´‡ (Make Webhook ì—°ê²°)</h1>
        <p class="text-sm">**</p>
    </header>

    <!-- ë©”ì‹œì§€ ì¶œë ¥ ì˜ì—­ -->
    <div id="messages" class="flex flex-col p-4 space-y-3 flex-grow">
        <div class="ai-message">
            ğŸ¤– ì•ˆë…•í•˜ì„¸ìš”! Make ì‹œë‚˜ë¦¬ì˜¤ì™€ Geminië¥¼ í†µí•´ ì—°ê²°ëœ ì±—ë´‡ì…ë‹ˆë‹¤. ì§ˆë¬¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.
        </div>
    </div>

    <!-- ì…ë ¥ ë° ì „ì†¡ ì˜ì—­ -->
    <div class="p-4 border-t border-gray-200 flex space-x-3">
        <input type="text" id="user-input" placeholder="ì—¬ê¸°ì— ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”..." 
               class="flex-grow p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
               onkeypress="if(event.keyCode === 13) sendMessage()">
        <button onclick="sendMessage()" id="send-button"
                class="bg-indigo-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-indigo-700 transition duration-150 shadow-md disabled:bg-gray-400">
            ì „ì†¡
        </button>
    </div>
</div>

<script>
    // â­ ì—¬ê¸°ì— Makeì—ì„œ ë³µì‚¬í•œ Webhook URLì„ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.
    // í˜•ì‹: https://hook.eu1.make.com/xxxxxxxxxxxxxxx
    const MAKE_WEBHOOK_URL = "https://hook.us2.make.com/beojnrbam68450c5366anrdb2lfdi8uq"; 
    
    // ë¡œë”© ìƒíƒœ ê´€ë¦¬
    let isSending = false;

    // Enter í‚¤ë¡œë„ ë©”ì‹œì§€ë¥¼ ë³´ë‚¼ ìˆ˜ ìˆë„ë¡ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
    document.getElementById('user-input').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            sendMessage();
        }
    });

    async function sendMessage() {
        const inputElement = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        const message = inputElement.value;
        const messagesDiv = document.getElementById('messages');

        if (!message.trim() || isSending) return;
        
        // 1. ìƒíƒœ ì—…ë°ì´íŠ¸ ë° ë²„íŠ¼ ë¹„í™œì„±í™”
        isSending = true;
        sendButton.disabled = true;

        // 2. ì‚¬ìš©ì ì§ˆë¬¸ì„ í™”ë©´ì— í‘œì‹œ
        messagesDiv.innerHTML += `<div class="user-message self-end">ğŸ§‘â€ğŸ’»: ${message}</div>`;
        inputElement.value = ''; // ì…ë ¥ì°½ ë¹„ìš°ê¸°

        // 3. ë¡œë”© ë©”ì‹œì§€ í‘œì‹œ
        const loadingDiv = document.createElement('div');
        loadingDiv.id = 'loading';
        loadingDiv.textContent = '... AIê°€ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...';
        messagesDiv.appendChild(loadingDiv);
        messagesDiv.scrollTop = messagesDiv.scrollHeight; // ìŠ¤í¬ë¡¤ í•˜ë‹¨ìœ¼ë¡œ ì´ë™

        try {
            // 4. Make Webhookìœ¼ë¡œ ë°ì´í„° ì „ì†¡
            const response = await fetch(MAKE_WEBHOOK_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    prompt: message // Webhookì´ ì¸ì‹í•˜ë„ë¡ êµ¬ì¡°ë¥¼ ë§ì¶¥ë‹ˆë‹¤.
                })
            });

            // 5. ì‘ë‹µ ì²˜ë¦¬ ë° ë¡œë”© ë©”ì‹œì§€ ì œê±°
            const data = await response.json();
            
            // ë¡œë”© ë©”ì‹œì§€ ì œê±°
            const currentLoadingDiv = document.getElementById('loading');
            if (currentLoadingDiv) currentLoadingDiv.remove();

            // 6. Geminiì˜ ë‹µë³€ì„ í™”ë©´ì— í‘œì‹œ
            let responseText = data.response_text || "ì‘ë‹µì„ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. Make ì‹œë‚˜ë¦¬ì˜¤ì˜ Webhook Response ëª¨ë“ˆì„ í™•ì¸í•´ì£¼ì„¸ìš”.";
            
            messagesDiv.innerHTML += `<div class="ai-message self-start">ğŸ¤–: ${responseText}</div>`;
            
        } catch (error) {
            console.error("Fetch Error:", error);
            
            const currentLoadingDiv = document.getElementById('loading');
            if (currentLoadingDiv) currentLoadingDiv.remove();
            
            messagesDiv.innerHTML += `<div class="ai-message self-start bg-red-100 text-red-700">âš ï¸ í†µì‹  ì˜¤ë¥˜ ë°œìƒ: ì›¹í›… URLì„ í™•ì¸í•˜ê±°ë‚˜ Make ì‹œë‚˜ë¦¬ì˜¤ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.</div>`;
        } finally {
            // 7. ìƒíƒœ ë³µêµ¬
            isSending = false;
            sendButton.disabled = false;
            messagesDiv.scrollTop = messagesDiv.scrollHeight; // ìŠ¤í¬ë¡¤ í•˜ë‹¨ìœ¼ë¡œ ì´ë™
        }
    }
</script>

</body>
</html>
